name = "r2"
main = "worker/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]
workers_dev = false
preview_urls = false

[build]
command = "npm run build"
cwd = "."

[assets]
directory = "dist"
binding = "ASSETS"

[[r2_buckets]]
binding = "R2"
bucket_name = "r2-bucket"

# ============================================
# RATE LIMITING CONFIGURATION
# ============================================
# Rate limiting bindings for API endpoint protection
# Three tiers: READ (600/60s), WRITE (200/60s), DELETE (60/60s)
[[ratelimits]]
name = "RATE_LIMITER_READ"
namespace_id = "1001"
simple = { limit = 600, period = 60 }

[[ratelimits]]
name = "RATE_LIMITER_WRITE"
namespace_id = "1002"
simple = { limit = 200, period = 60 }

[[ratelimits]]
name = "RATE_LIMITER_DELETE"
namespace_id = "1003"
simple = { limit = 60, period = 60 }

# D1 database for job history metadata
[[d1_databases]]
binding = "METADATA"
database_name = "r2-manager-metadata"
database_id = "117f108b-f2f0-46c1-9c15-560d11b0a7dd"

[[routes]]
pattern = "r2.adamic.tech"
custom_domain = true
zone_name = "adamic.tech"

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
head_sampling_rate = 1
persist = true